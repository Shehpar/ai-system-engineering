[agent]
  interval = "10s"
  round_interval = true

# 0. Docker Container Metrics (per-container CPU/Mem/Network)
[[inputs.docker]]
  endpoint = "tcp://host.docker.internal:2375"
  gather_services = false
  timeout = "5s"

# 1. System CPU (Host level)
[[inputs.cpu]]
  percpu = false
  totalcpu = true
  fieldinclude = ["usage_idle"]

# 2. System RAM (Host level)
[[inputs.mem]]
  fieldinclude = ["used_percent"]

# 3. System Network (Host level)
[[inputs.net]]
  interfaces = ["eth0"]
  fieldinclude = ["bytes_sent", "bytes_recv"]

# 4. Process Stats - Track Python processes (Flask, AI app)
[[inputs.procstat]]
  pattern = "python|telegraf"
  fieldinclude = ["cpu_usage", "memory_rss"]
  [inputs.procstat.tags]
    process_type = "application"

# 5. Network Connections - Track TCP states
[[inputs.netstat]]
  [inputs.netstat.tags]
    monitoring = "connections"

# 6. Connection Details - Track TCP connection states
[[inputs.exec]]
  commands = ["cat /proc/net/tcp"]
  timeout = "5s"
  data_format = "grok"
  grok_patterns = ["^\\s*\\d+:\\s+(?P<local>\\S+)\\s+(?P<remote>\\S+)\\s+(?P<state>[0-9A-Fa-f]+)"]
  name_override = "tcp_detail"
  [inputs.exec.tags]
    connection_source = "proc_net_tcp"

[[outputs.influxdb]]
  urls = ["http://host.docker.internal:8086"]
  database = "system_metrics"
  timeout = "5s"